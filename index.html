<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>amnesfubbia xx1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@1,700&family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <style>
        body { background-color: #000; color: #fff; font-family: 'Inter', sans-serif; margin: 0; overflow-x: hidden; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .fixed-header-section { position: fixed; top: 0; width: 100%; z-index: 100; background: #000; border-bottom: 1px solid #1c1c1c; }
        .ig-header { padding: 12px 15px 5px 15px; }
        .ig-logo { font-family: 'DM Sans', sans-serif; font-weight: 700; font-style: italic; font-size: 24px; letter-spacing: -0.8px; text-transform: lowercase; cursor: pointer; }
        .search-container { background: #0a0a0a; border-radius: 8px; display: flex; align-items: center; padding: 7px 12px; flex-grow: 1; border: 1px solid #1c1c1c; }
        .search-container input { background: transparent; border: none; color: white; font-size: 13px; width: 100%; outline: none; margin-left: 8px; }

        /* NAV DROPDOWN */
        .nav-dropdown { display: none; position: fixed; left: 0; right: 0; top: 220px; background: #0a0a0a; border-bottom: 1px solid #1c1c1c; z-index: 110; max-height: 300px; overflow-y: auto; padding: 10px; }
        .drop-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; }
        .drop-item { padding: 12px; font-size: 10px; font-weight: 700; text-align: center; background: #111; border: 1px solid #1c1c1c; border-radius: 8px; cursor: pointer; text-transform: uppercase; }
        
        .category-wrapper { padding: 5px 15px 12px 15px; }
        .pill-grid { display: grid; gap: 6px; }
        .pill { background: transparent; border: 1px solid #1c1c1c; color: #fff; padding: 8px 0; border-radius: 8px; font-size: 10px; font-weight: 800; text-transform: uppercase; text-align: center; cursor: pointer; }
        .pill.active { background: #fff; color: #000; border-color: #fff; }
        
        .movie-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1px; padding-top: 250px; padding-bottom: 100px; }
        .post-card { position: relative; aspect-ratio: 2/3; background: #0a0a0a; overflow: hidden; }
        .post-card img { width: 100%; height: 100%; object-fit: cover; }
        .badge-rating { position: absolute; top: 6px; left: 6px; padding: 2px 5px; border-radius: 2px; font-size: 7px; font-weight: 900; z-index: 5; background: rgba(255,255,255,0.9); color: #000; }
        
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: #000; border-top: 1px solid #1c1c1c; display: flex; justify-content: space-around; padding: 12px 0; z-index: 300; }
        .nav-item { color: #fff; font-size: 20px; cursor: pointer; }
        
        .modal-player { display: none; position: fixed; inset: 0; z-index: 400; background: #000; overflow-y: auto; }
        .interaction-icon { font-size: 24px; cursor: pointer; }
        .server-btn { width: 100%; padding: 14px; border-radius: 12px; font-size: 10px; font-weight: 800; text-transform: uppercase; border: 1px solid #1c1c1c; text-align: center; cursor: pointer; }
        .story-img { width: 56px; height: 56px; border-radius: 50%; object-fit: cover; }
        .skeleton { background: #111; animation: pulse 1.5s infinite; }
        @keyframes pulse { 50% { opacity: 0.5; } }
    </style>
</head>
<body>
    <div id="loader" style="position:fixed; top:0; left:0; height:1.5px; background:#fff; width:0%; transition:width 0.3s; z-index:1000;"></div>

    <div class="fixed-header-section" id="topNav">
        <header class="ig-header">
            <div class="flex justify-between items-center">
                <div class="flex items-center">
                    <h1 class="ig-logo" onclick="location.reload()">amnesfubbia <span class="text-white opacity-40 font-normal italic">xx1</span></h1>
                </div>
                <div class="flex gap-6 text-xl"><i class="fa-regular fa-heart" onclick="showLibrary('likes')"></i></div>
            </div>
            <div class="search-container mt-2">
                <i class="fa-solid fa-magnifying-glass text-zinc-600 text-[10px]"></i>
                <input type="text" id="searchInp" placeholder="Cari film, series, anime..." onkeydown="if(event.key==='Enter') searchAction()">
            </div>
        </header>
        <div class="category-wrapper">
            <div class="pill-grid grid-cols-5 mb-2">
                <button class="pill active" onclick="setFilter('type', 'multi', this)">Semua</button>
                <button class="pill" onclick="setFilter('type', 'movie', this)">Film</button>
                <button class="pill" onclick="setFilter('type', 'tv', this)">Series</button>
                <button class="pill" onclick="setFilter('type', 'anime', this)">Anime</button>
                <button class="pill" onclick="setFilter('type', 'short', this)">Short</button>
            </div>
            <div class="pill-grid grid-cols-4 mb-2">
                <button class="pill active" onclick="setSchedule('trending', this)">Trending</button>
                <button class="pill" onclick="setSchedule('popular', this)">Populer</button>
                <button class="pill" onclick="setSchedule('now_playing', this)">Tayang</button>
                <button class="pill" onclick="setSchedule('upcoming', this)">Akan Datang</button>
            </div>
            <div class="pill-grid grid-cols-3">
                <button class="pill" id="btnC" onclick="toggleNavDrop('country')">Negara <i class="fa-solid fa-caret-down text-[7px] ml-1"></i></button>
                <button class="pill" id="btnG" onclick="toggleNavDrop('genre')">Genre <i class="fa-solid fa-caret-down text-[7px] ml-1"></i></button>
                <button class="pill" id="btnY" onclick="toggleNavDrop('year')">Tahun <i class="fa-solid fa-caret-down text-[7px] ml-1"></i></button>
            </div>
        </div>
    </div>

    <div id="dropCountry" class="nav-dropdown no-scrollbar"><div class="drop-grid" id="countryList"></div></div>
    <div id="dropGenre" class="nav-dropdown no-scrollbar"><div class="drop-grid" id="genreList"></div></div>
    <div id="dropYear" class="nav-dropdown no-scrollbar"><div class="drop-grid" id="yearList"></div></div>

    <main id="feedGrid" class="movie-grid"></main>

    <div id="movieModal" class="modal-player">
        <div class="max-w-xl mx-auto pb-40">
            <div class="px-4 h-[54px] flex items-center border-b border-zinc-900 sticky top-0 bg-black z-50">
                <i class="fa-solid fa-chevron-left text-xl cursor-pointer" onclick="closeModal()"></i>
                <div class="flex-grow text-center px-8">
                    <h2 id="mTitle" class="truncate text-sm font-bold"></h2>
                </div>
            </div>
            <div class="py-4 bg-black">
                <div id="mCast" class="flex gap-4 overflow-x-auto no-scrollbar px-4"></div>
            </div>
            <div class="aspect-video bg-zinc-900 w-full relative">
                <iframe id="videoPlayer" class="w-full h-full" allowfullscreen></iframe>
            </div>
            <div class="px-4 py-3 flex justify-between items-center">
                <div class="flex gap-4">
                    <i id="btnLikeModal" onclick="toggleLike()" class="interaction-icon fa-regular fa-heart"></i>
                    <i class="fa-regular fa-comment interaction-icon"></i>
                </div>
                <i id="btnBookModal" onclick="toggleBook()" class="interaction-icon fa-regular fa-bookmark"></i>
            </div>
            <div class="px-4">
                <p id="mDesc" class="text-sm text-zinc-300"></p>
                <div id="serverList" class="grid grid-cols-2 gap-2 mt-6"></div>
            </div>
        </div>
    </div>

    <nav class="bottom-nav">
        <div class="nav-item" onclick="location.reload()"><i class="fa-solid fa-house"></i></div>
        <div class="nav-item" onclick="document.getElementById('searchInp').focus()"><i class="fa-solid fa-magnifying-glass"></i></div>
        <div class="nav-item" onclick="showLibrary('bookmarks')"><i class="fa-regular fa-bookmark"></i></div>
    </nav>

    <script>
        const API_KEY = 'bfa7df5310c9974f62f26c6789a8c00d';
        let page = 1, loading = false, currentType = 'multi', currentGenre = '', currentYear = '', currentCountry = '', searchQuery = '', currentSchedule = 'trending', currentMedia = null;

        window.onload = () => { initDrops(); loadFeed(); };

        function initDrops() {
            const years = []; for(let i=2026; i>=1990; i--) years.push(i);
            document.getElementById('yearList').innerHTML = '<div class="drop-item" onclick="setYear(\'\')">Semua</div>' + years.map(y => `<div class="drop-item" onclick="setYear(${y})">${y}</div>`).join('');
            
            const countries = [{id:'US',n:'USA'},{id:'KR',n:'KOREA'},{id:'JP',n:'JEPANG'},{id:'ID',n:'INDO'},{id:'TH',n:'THAI'},{id:'CN',n:'CHINA'}];
            document.getElementById('countryList').innerHTML = '<div class="drop-item" onclick="setCountry(\'\')">Global</div>' + countries.map(c => `<div class="drop-item" onclick="setCountry('${c.id}')">${c.n}</div>`).join('');

            const genres = [{id:28,n:'Aksi'},{id:16,n:'Anime'},{id:35,n:'Komedi'},{id:27,n:'Horor'},{id:10749,n:'Romantis'},{id:878,n:'Sci-Fi'}];
            document.getElementById('genreList').innerHTML = '<div class="drop-item" onclick="setGenre(\'\')">Semua</div>' + genres.map(g => `<div class="drop-item" onclick="setGenre(${g.id})">${g.n}</div>`).join('');
        }

        function toggleNavDrop(id) {
            const target = 'drop' + id.charAt(0).toUpperCase() + id.slice(1);
            ['dropCountry','dropGenre','dropYear'].forEach(d => {
                const el = document.getElementById(d);
                el.style.display = (d === target && el.style.display !== 'block') ? 'block' : 'none';
            });
        }

        async function loadFeed(isNew = true) {
            if (loading) return; loading = true;
            if (isNew) { page = 1; document.getElementById('feedGrid').innerHTML = ''; }
            
            try {
                let url = '';
                const params = `&api_key=${API_KEY}&language=id-ID&page=${page}&include_adult=false`;
                
                // Logika Filter Akurat menggunakan Discover
                if (searchQuery) {
                    url = `https://api.themoviedb.org/3/search/multi?query=${encodeURIComponent(searchQuery)}${params}`;
                } else {
                    let type = (currentType === 'tv' || currentType === 'anime') ? 'tv' : 'movie';
                    if (currentType === 'multi') type = 'movie'; // Default discover

                    if (currentSchedule === 'trending') {
                        url = `https://api.themoviedb.org/3/trending/${type}/day?${params}`;
                    } else {
                        url = `https://api.themoviedb.org/3/discover/${type}?${params}`;
                        if (currentGenre) url += `&with_genres=${currentGenre}`;
                        if (currentYear) url += type === 'movie' ? `&primary_release_year=${currentYear}` : `&first_air_date_year=${currentYear}`;
                        if (currentCountry) url += `&with_origin_country=${currentCountry}`;
                        if (currentType === 'anime') url += `&with_genres=16&with_keywords=210024`;
                        if (currentType === 'short') url += `&with_runtime.lte=40`;
                    }
                }

                const res = await fetch(url);
                const data = await res.json();
                renderFeed(data.results || []);
            } catch (e) { console.error(e); }
            loading = false;
        }

        function renderFeed(data) {
            const grid = document.getElementById('feedGrid');
            data.forEach(m => {
                if (!m.poster_path) return;
                const card = document.createElement('div');
                card.className = 'post-card';
                card.onclick = () => openModal(m.id, m.media_type || (currentType === 'tv' ? 'tv' : 'movie'));
                card.innerHTML = `<div class="badge-rating"><i class="fa-solid fa-star"></i> ${m.vote_average?.toFixed(1)}</div><img src="https://image.tmdb.org/t/p/w342${m.poster_path}">`;
                grid.appendChild(card);
            });
        }

        async function openModal(id, type) {
            currentMedia = { id, type };
            const modal = document.getElementById('movieModal');
            modal.style.display = 'block'; document.body.style.overflow = 'hidden';
            
            try {
                const res = await fetch(`https://api.themoviedb.org/3/${type}/${id}?api_key=${API_KEY}&language=id-ID&append_to_response=videos,credits`);
                const d = await res.json();
                
                document.getElementById('mTitle').innerText = d.title || d.name;
                document.getElementById('mDesc').innerText = d.overview || "Tidak ada sinopsis.";
                
                // Klik Pemeran
                document.getElementById('mCast').innerHTML = (d.credits?.cast || []).slice(0,10).map(c => `
                    <div class="flex-shrink-0 text-center" onclick="searchActor('${c.name}')">
                        <img src="https://image.tmdb.org/t/p/w185${c.profile_path}" class="story-img border-2 border-zinc-800">
                        <p class="text-[9px] mt-1 text-zinc-400">${c.name.split(' ')[0]}</p>
                    </div>`).join('');

                // 2 Server & Trailer Logic
                const trailer = d.videos?.results.find(v => v.type === 'Trailer')?.key;
                const embedUrl = `https://vidrock.net/embed/${type}/${id}`;
                document.getElementById('videoPlayer').src = trailer ? `https://www.youtube.com/embed/${trailer}?autoplay=1` : embedUrl;
                
                document.getElementById('serverList').innerHTML = `
                    <button class="server-btn bg-white text-black" onclick="document.getElementById('videoPlayer').src='${embedUrl}'">Server Streaming</button>
                    <button class="server-btn" onclick="window.open('https://dl.vidsrc.vip/${type}/${id}', '_blank')">Download HD</button>
                `;
                updateLikeBtn();
            } catch(e) { console.error(e); }
        }

        function searchActor(name) { closeModal(); document.getElementById('searchInp').value = name; searchAction(); }
        function closeModal() { document.getElementById('movieModal').style.display = 'none'; document.getElementById('videoPlayer').src = ''; document.body.style.overflow = 'auto'; }
        
        // Filter Actions
        function setFilter(t, v, el) { currentType = v; updatePills(el); loadFeed(true); }
        function setSchedule(v, el) { currentSchedule = v; updatePills(el); loadFeed(true); }
        function setYear(y) { currentYear = y; document.getElementById('btnY').innerHTML = (y || 'Tahun') + ' <i class="fa-solid fa-caret-down text-[7px] ml-1"></i>'; toggleNavDrop('year'); loadFeed(true); }
        function setGenre(g) { currentGenre = g; toggleNavDrop('genre'); loadFeed(true); }
        function setCountry(c) { currentCountry = c; toggleNavDrop('country'); loadFeed(true); }
        function searchAction() { searchQuery = document.getElementById('searchInp').value; loadFeed(true); }
        function updatePills(el) { el.parentElement.querySelectorAll('.pill').forEach(p => p.classList.remove('active')); el.classList.add('active'); }

        // Like & Save Logic
        function getStore(k) { return JSON.parse(localStorage.getItem(k) || '[]'); }
        function toggleLike() {
            let likes = getStore('likes');
            const idx = likes.findIndex(x => x.id == currentMedia.id);
            if(idx > -1) likes.splice(idx, 1); else likes.push(currentMedia);
            localStorage.setItem('likes', JSON.stringify(likes)); updateLikeBtn();
        }
        function updateLikeBtn() {
            const isL = getStore('likes').some(x => x.id == currentMedia.id);
            document.getElementById('btnLikeModal').className = isL ? 'fa-solid fa-heart text-red-500 interaction-icon' : 'fa-regular fa-heart interaction-icon';
        }

        window.onscroll = () => { if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 800 && !loading) { page++; loadFeed(false); } };
    </script>
</body>
</html>
