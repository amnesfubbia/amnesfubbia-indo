<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AMNESFUBBIA FILM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { background-color: #050505; color: white; font-family: 'Plus Jakarta Sans', sans-serif; margin: 0; overflow-x: hidden; }

        .nav-fixed {
            position: fixed; top: 0; left: 0; right: 0;
            background: rgba(5, 5, 5, 0.95); backdrop-filter: blur(15px);
            border-bottom: 1px solid rgba(255,255,255,0.1); z-index: 50; padding: 12px 0 8px 0;
        }

        #loadingBar { position: absolute; bottom: 0; left: 0; height: 2px; background: #e11d48; width: 0; transition: width 0.3s; }

        /* Modern Pill Navigation */
        .pill-container { display: flex; gap: 8px; overflow-x: auto; padding: 5px 12px; scrollbar-width: none; }
        .pill-container::-webkit-scrollbar { display: none; }
        .pill { 
            white-space: nowrap; padding: 6px 15px; background: #1a1a1a; border: 1px solid #333; 
            border-radius: 20px; font-size: 10px; font-weight: 700; color: #888; cursor: pointer; transition: 0.3s;
        }
        .pill.active { background: #e11d48; color: white; border-color: #e11d48; }

        .search-input {
            width: 100%; background: #1a1a1a; border: 1px solid #333;
            padding: 8px 35px 8px 12px; border-radius: 8px; color: white; font-size: 11px; outline: none;
        }

        .movie-grid {
            display: grid; grid-template-columns: repeat(3, 1fr);
            gap: 8px; padding: 185px 8px 80px 8px;
        }

        /* Skeleton & Card Animation */
        .card { 
            position: relative; aspect-ratio: 2/3; background: #111; 
            border-radius: 8px; overflow: hidden; border: 1px solid #222; 
            cursor: pointer; transition: all 0.3s ease;
        }
        .skeleton { animation: pulse 1.5s infinite ease-in-out; background: linear-gradient(90deg, #111 25%, #1a1a1a 50%, #111 75%); background-size: 200% 100%; }
        @keyframes pulse { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

        .card img { width: 100%; height: 100%; object-fit: cover; opacity: 0; transition: opacity 0.5s; }
        .card img.loaded { opacity: 1; }
        .card:active { transform: scale(0.95); border-color: #e11d48; }

        .history-scroll { display: flex; gap: 8px; overflow-x: auto; padding: 8px 12px; scrollbar-width: none; background: #000; }
        .hist-item { flex: 0 0 45px; aspect-ratio: 2/3; border-radius: 4px; overflow: hidden; border: 1px solid #333; }

        #backToTop {
            display: none; position: fixed; bottom: 20px; right: 20px;
            width: 40px; height: 40px; background: #e11d48; color: white;
            border-radius: 50%; border: none; z-index: 40; cursor: pointer; font-size: 14px;
        }

        .modal { display: none; position: fixed; inset: 0; z-index: 100; background: black; overflow-y: auto; }
        .modal-box { min-height: 100vh; background: #080808; padding: 15px 15px 50px 15px; padding-top: 50px; }
        
        .cast-scroll { display: flex; gap: 10px; overflow-x: auto; padding: 10px 0; scrollbar-width: none; }
        .cast-card { flex: 0 0 70px; text-align: center; }
        .cast-img { width: 65px; height: 65px; border-radius: 50%; object-fit: cover; border: 2px solid #333; margin-bottom: 5px; }
        .cast-name { font-size: 8px; font-weight: bold; color: #ccc; }

        .btn-red { display: flex; justify-content: space-between; align-items: center; width: 100%; padding: 12px; margin-bottom: 8px; background: #e11d48; color: white; border-radius: 8px; font-size: 10px; font-weight: 800; }
        .info-page { display: none; position: fixed; inset: 0; z-index: 200; background: rgba(0,0,0,0.9); backdrop-filter: blur(10px); padding: 40px 20px; text-align: center; }
    </style>
</head>
<body>

    <div id="modalAbout" class="info-page" onclick="this.style.display='none'">
        <div class="mt-20">
            <h2 class="text-2xl font-black italic mb-4">AMNESFUBBIA<span class="text-red-600">FILM</span></h2>
            <p class="text-xs text-gray-400">Database Film Indonesia Modern. Rasakan Pengalaman Netflix Style.</p>
        </div>
    </div>

    <button id="backToTop" onclick="window.scrollTo({top: 0, behavior: 'smooth'})"><i class="fa-solid fa-arrow-up"></i></button>

    <nav class="nav-fixed">
        <div id="loadingBar"></div>
        <div class="container mx-auto px-3">
            <div class="flex items-center gap-2 mb-3">
                <div onclick="location.reload()" class="cursor-pointer shrink-0 uppercase font-black italic text-sm">AMNESFUBBIA<span class="text-red-600">FILM</span></div>
                <i class="fa-solid fa-circle-info text-gray-600 text-xs" onclick="document.getElementById('modalAbout').style.display='block'"></i>
                <div class="relative w-full">
                    <input type="text" id="inputCari" class="search-input" placeholder="Cari Film / Pemeran..." onkeyup="if(event.key==='Enter') cariFilm()">
                </div>
            </div>
            
            <div class="pill-container" id="tipePills">
                <div class="pill active" onclick="updateFilter('tipe', 'multi', this)">SEMUA</div>
                <div class="pill" onclick="updateFilter('tipe', 'movie', this)">FILM</div>
                <div class="pill" onclick="updateFilter('tipe', 'tv', this)">SERIES</div>
                <div class="pill" onclick="updateFilter('tipe', 'short', this)">SHORT</div>
            </div>
            <div class="pill-container" id="genrePills">
                <div class="pill active" onclick="updateFilter('genre', '', this)">SEMUA GENRE</div>
                <div class="pill" onclick="updateFilter('genre', '28', this)">AKSI</div>
                <div class="pill" onclick="updateFilter('genre', '27', this)">HOROR</div>
                <div class="pill" onclick="updateFilter('genre', '35', this)">KOMEDI</div>
                <div class="pill" onclick="updateFilter('genre', '18', this)">DRAMA</div>
                <div class="pill" onclick="updateFilter('genre', '10749', this)">ROMANTIS</div>
            </div>
        </div>
        <div id="historyBar" class="history-scroll hidden"></div>
    </nav>

    <div id="gridFilm" class="movie-grid"></div>

    <div id="modalFilm" class="modal">
        <div class="modal-box">
            <button onclick="tutupModal()" class="fixed top-4 right-4 bg-red-600 text-white w-8 h-8 rounded-full z-[110] font-bold text-xs">✕</button>
            <h1 id="jdl" class="text-base font-black uppercase"></h1>
            <p id="inf" class="text-[9px] text-gray-500 font-bold mb-1"></p>
            <p id="gen" class="text-[9px] text-red-500 font-bold mb-4 uppercase"></p>
            <div class="aspect-video bg-black rounded-lg overflow-hidden mb-5 border border-white/10">
                <iframe id="layar" class="w-full h-full" allowfullscreen></iframe>
            </div>
            <p class="text-gray-600 text-[8px] font-black uppercase tracking-widest mb-1">Pemeran Utama</p>
            <div id="castList" class="cast-scroll"></div>
            <p id="sinop" class="text-xs text-gray-400 italic my-6 leading-relaxed"></p>
            <div id="btnStream"></div>
            <div id="btnDown" class="mt-4"></div>
        </div>
    </div>

    <script>
        const API = 'bfa7df5310c9974f62f26c6789a8c00d';
        let hal = 1, sedangMemuat = false, fTipe = 'multi', fGenre = '';

        window.onload = () => { memuatFilm(); updateHistoryUI(); };

        // Pull to refresh
        let startY = 0;
        window.addEventListener('touchstart', e => startY = e.touches[0].pageY);
        window.addEventListener('touchmove', e => { if (window.scrollY === 0 && e.touches[0].pageY > startY + 150) location.reload(); });

        window.onscroll = () => { 
            const btt = document.getElementById('backToTop');
            btt.style.display = window.scrollY > 500 ? 'block' : 'none';
            if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 600 && !sedangMemuat) loadLagi(); 
        };

        function updateFilter(type, val, el) {
            const parent = type === 'tipe' ? 'tipePills' : 'genrePills';
            document.querySelectorAll(`#${parent} .pill`).forEach(p => p.classList.remove('active'));
            el.classList.add('active');
            if(type === 'tipe') fTipe = val; else fGenre = val;
            resetLoad();
        }

        async function memuatFilm() {
            if (sedangMemuat) return; sedangMemuat = true;
            document.getElementById('loadingBar').style.width = '40%';
            
            // Tampilkan Skeletons hanya saat load pertama
            if(hal === 1) {
                document.getElementById('gridFilm').innerHTML = Array(9).fill('<div class="card skeleton"></div>').join('');
            }

            try {
                let res;
                if(fTipe === 'multi') {
                    const [f, t] = await Promise.all([
                        fetch(`https://api.themoviedb.org/3/discover/movie?api_key=${API}&with_origin_country=ID&language=id-ID&page=${hal}${fGenre ? '&with_genres='+fGenre : ''}`),
                        fetch(`https://api.themoviedb.org/3/discover/tv?api_key=${API}&with_origin_country=ID&language=id-ID&page=${hal}${fGenre ? '&with_genres='+fGenre : ''}`)
                    ]);
                    const dF = await f.json(), dT = await t.json();
                    res = [...dF.results, ...dT.results].sort((a,b) => b.popularity - a.popularity);
                } else {
                    let url = `https://api.themoviedb.org/3/discover/${fTipe==='short'?'movie':fTipe}?api_key=${API}&with_origin_country=ID&language=id-ID&page=${hal}`;
                    if(fTipe === 'short') url += '&with_runtime.lte=45';
                    if(fGenre) url += `&with_genres=${fGenre}`;
                    const r = await fetch(url); const d = await r.json();
                    res = d.results;
                }
                tampilkan(res);
            } finally {
                sedangMemuat = false;
                document.getElementById('loadingBar').style.width = '100%';
                setTimeout(() => document.getElementById('loadingBar').style.width = '0', 300);
            }
        }

        function tampilkan(data) {
            const grid = document.getElementById('gridFilm');
            if(hal === 1) grid.innerHTML = '';
            data.forEach(m => {
                if(!m.poster_path) return;
                const tipe = m.title ? 'movie' : 'tv';
                const kartu = document.createElement('div');
                kartu.className = 'card';
                kartu.onclick = () => { saveHistory(m.id, tipe, m.poster_path); bukaModal(m.id, tipe); };
                kartu.innerHTML = `<img src="https://image.tmdb.org/t/p/w500${m.poster_path}" onload="this.classList.add('loaded')">`;
                grid.appendChild(kartu);
            });
        }

        async function bukaModal(id, tipe) {
            document.getElementById('modalFilm').style.display = 'block';
            document.body.style.overflow = 'hidden';
            const res = await fetch(`https://api.themoviedb.org/3/${tipe}/${id}?api_key=${API}&language=id-ID&append_to_response=videos,credits`);
            const d = await res.json();
            
            document.getElementById('jdl').innerText = d.title || d.name;
            let meta = (d.release_date || d.first_air_date || '').split('-')[0];
            if(tipe === 'tv') meta += ` • ${d.number_of_episodes} Episode`;
            document.getElementById('inf').innerText = `${meta} • ⭐ ${d.vote_average.toFixed(1)}`;
            document.getElementById('gen').innerText = d.genres.map(g => g.name).join(', ');
            document.getElementById('sinop').innerText = d.overview || "Sinopsis belum tersedia.";
            
            const v = d.videos.results.find(v => v.site === 'YouTube');
            document.getElementById('layar').src = v ? `https://www.youtube.com/embed/${v.key}?autoplay=1` : `https://vidsrc.xyz/embed/${tipe}/${id}`;
            
            document.getElementById('castList').innerHTML = d.credits.cast.slice(0, 10).map(c => `
                <div class="cast-card" onclick="cariPemeran(${c.id})">
                    <img class="cast-img" src="${c.profile_path ? 'https://image.tmdb.org/t/p/w200'+c.profile_path : 'https://via.placeholder.com/100'}">
                    <p class="cast-name">${c.name}</p>
                </div>
            `).join('');

            const b = (n, l) => `<button onclick="document.getElementById('layar').src='${l}'" class="btn-red"><span>${n}</span> <i class="fa-solid fa-play"></i></button>`;
            document.getElementById('btnStream').innerHTML = b('SERVER 1', `https://vidsrc.xyz/embed/${tipe}/${id}`) + b('SERVER 2', `https://vidsrc.to/embed/${tipe}/${id}`) + b('SERVER 3', `https://vidsrc.me/embed/${tipe}/${id}`);
            document.getElementById('btnDown').innerHTML = `<a href="https://dl.vidsrc.vip/${tipe}/${id}" target="_blank" class="btn-red"><span>DOWNLOAD VIP</span> <i class="fa-solid fa-download"></i></a>`;
        }

        async function cariPemeran(pId) {
            tutupModal();
            document.getElementById('loadingBar').style.width = '50%';
            const res = await fetch(`https://api.themoviedb.org/3/person/${pId}/combined_credits?api_key=${API}&language=id-ID`);
            const d = await res.json();
            const hasil = d.cast.filter(m => m.original_language === 'id' || (m.origin_country && m.origin_country.includes('ID')));
            hal = 1; tampilkan(hasil); window.scrollTo(0,0);
        }

        async function cariFilm() {
            const q = document.getElementById('inputCari').value; if(!q) return;
            document.getElementById('loadingBar').style.width = '50%';
            const res = await fetch(`https://api.themoviedb.org/3/search/multi?api_key=${API}&query=${q}&language=id-ID`);
            const d = await res.json();
            const h = d.results.filter(m => m.original_language === 'id' || (m.origin_country && m.origin_country.includes('ID')));
            hal = 1; tampilkan(h); window.scrollTo(0,0);
        }

        function saveHistory(id, tipe, path) {
            let h = JSON.parse(localStorage.getItem('hist_amnes')) || [];
            h = h.filter(x => x.id !== id); h.unshift({id, tipe, path});
            localStorage.setItem('hist_amnes', JSON.stringify(h.slice(0, 10)));
            updateHistoryUI();
        }

        function updateHistoryUI() {
            const h = JSON.parse(localStorage.getItem('hist_amnes')) || [];
            const bar = document.getElementById('historyBar');
            if(h.length === 0) return;
            bar.classList.remove('hidden');
            bar.innerHTML = h.map(x => `<div class="hist-item" onclick="bukaModal(${x.id}, '${x.tipe}')"><img src="https://image.tmdb.org/t/p/w200${x.path}"></div>`).join('');
        }

        function tutupModal() { document.getElementById('modalFilm').style.display='none'; document.getElementById('layar').src=''; document.body.style.overflow='auto'; }
        function loadLagi() { hal++; memuatFilm(); }
        function resetLoad() { hal = 1; window.scrollTo(0,0); memuatFilm(); }
    </script>
</body>
</html>
